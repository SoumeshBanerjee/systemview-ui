!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1),r=n(2),i=n(3),s=document.getElementById("plot"),c=document.getElementById("file");i.resize(s);const a={hovermode:"closest",showlegend:!0,dragmode:"pan",xaxis:{range:[0,.01],showspikes:!0,spikemode:"across",spikedash:"solid",spikecolor:"#000000",spikethickness:.5},yaxis:{title:"Core 0",domain:[.5,1],fixedrange:!0,showgrid:!1,zeroline:!1,showline:!1},yaxis2:{title:"Core 1",domain:[0,.48],fixedrange:!0,showgrid:!1,zeroline:!1,showline:!1},spikedistance:200,hoverdistance:10,grid:{rows:2,columns:1,subplots:[["xy"],["xy2"]]}};function l(e){const t=new Set(o.IGNORE_RENDER_SYS_STREAM_LIST.map(t=>e.streams.system[t])),n=r.generateLookupTable(e.events),i=r.calculateAndInjectDataPoints(e.events,n,t,e.streams.system.SYS_OVERFLOW);a.xaxis.range=[i.xmin,.01];const s=r.populatePlotData(n);return console.log("Plot data"),console.dir(s),s}c.addEventListener("change",e=>{const t=e.target.files[0];if(!t||!t.type.match("application/json"))return;const n=new FileReader;n.addEventListener("loadend",e=>{try{const t=l(JSON.parse(e.target.result));Plotly.react(s,t,a,{displaylogo:!1,scrollZoom:!0,responsive:!0})}catch(e){alert("Invalid JSON File"+e)}}),n.readAsBinaryString(t)}),async function(){fetch("https://soumeshbanerjee.github.io/systemview-ui/mcore.json").then(e=>e.json()).then(e=>{const t=l(e);Plotly.newPlot(s,t,a,{displaylogo:!1,scrollZoom:!0,responsive:!0})}).catch(e=>{console.error(e),alert("Failed to fetch mcore.json")})}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IGNORE_RENDER_SYS_STREAM_LIST=["SYS_INIT","SYS_MODULEDESC","SYS_NAME_RESOURCE","SYS_NOP","SYS_NUMMODULES","SYS_STACK_INFO","SYS_SYSDESC","SYS_SYSTIME_CYCLES","SYS_SYSTIME_US","SYS_TRACE_START","SYS_TRACE_STOP","SYS_TASK_INFO"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLookupTable=function(e){const t={};return e.forEach(e=>{t[e.core_id]||(t[e.core_id]={irq:{},ctx:{},lastEvent:null,contextSwitch:{name:"context-switch",line:{color:"blue",width:.5},mode:"lines",opacity:.5,type:"scatterql",x:[],y:[],xaxis:"x",yaxis:1===e.core_id?"y2":"y",hoverinfo:"skip"}}),!0!==e.in_irq||t[e.core_id].irq.hasOwnProperty(e.ctx_name)?!1!==e.in_irq||t[e.core_id].ctx.hasOwnProperty(e.ctx_name)||(t[e.core_id].ctx[e.ctx_name]={}):t[e.core_id].irq[e.ctx_name]={}}),t},t.calculateAndInjectDataPoints=function(e,t,n,o){function r(e,n){const o=t[e].lastEvent;if(!o)return;const r=!0===o.in_irq?t[e].irq[o.ctx_name]:t[e].ctx[o.ctx_name];r.x.push(n,null),r.y.push(r.name,null)}const i={xmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY};return e.forEach(e=>{if(n.has(e.id))return;if(e.id===o)return console.log("Halt event arrived",e),r(0,e.ts),r(1,e.ts),t[0].lastEvent=null,void(t[1].lastEvent=null);e.ts>=i.xmax&&(i.xmax=e.ts),e.ts<=i.xmin&&(i.xmin=e.ts);let s=t[e.core_id].ctx[e.ctx_name];!0===e.in_irq&&(s=t[e.core_id].irq[e.ctx_name]),s.type||(s.type="scattergl",s.mode="lines",s.opacity=1,s.line={width:20},s.name=!0===e.in_irq?"IRQ: "+e.ctx_name:e.ctx_name,1===e.core_id&&(s.yaxis="y2",s.xaxis="x"),s.y=[],s.x=[]),r(e.core_id,e.ts);const c=t[e.core_id].lastEvent;if(c){const n=!0===c.in_irq?t[e.core_id].irq[c.ctx_name]:t[e.core_id].ctx[c.ctx_name];!function(e,n,o,r){if(n===o)return;const i=t[e].contextSwitch;i.x.push(r,r,null),i.y.push(n,o,null)}(e.core_id,n.name,s.name,e.ts)}s.x.push(e.ts),s.y.push(s.name),t[e.core_id].lastEvent=e}),i},t.populatePlotData=function(e){const t=[],n=function(e){const t=Plotly.d3.scale.category20(),n=new Map;let o=0;function r(e){Object.keys(e).forEach(e=>{n.has(e)||("scheduler"===e?n.set(e,"#000000"):e.match(/^IDLE[0-9]*/)?n.set(e,"#ffd4ff"):n.set(e,t(o++)))})}return Object.keys(e).forEach(t=>{r(e[t].ctx),r(e[t].irq)}),n}(e);return Object.keys(e).forEach(o=>{const r=e[o],i=new Set,s=new Set(Object.keys(r.ctx));s.forEach(e=>{e.match(/^IDLE[0-9]*/)&&(i.add(e),s.delete(e))}),s.forEach(e=>{"scheduler"!==e&&(i.add(e),s.delete(e))}),s.has("scheduler")&&(i.add("scheduler"),s.delete("scheduler")),i.forEach(e=>{const o=n.get(e),i=r.ctx[e];o&&"lines"===i.mode&&(i.line.color=o),t.push(i)}),Object.keys(r.irq).forEach(e=>{const o=n.get(e),i=r.irq[e];o&&"lines"===i.mode&&(i.line.color=o),t.push(i)}),t.push(r.contextSwitch)}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resize=function(e){interact(e).resizable({edges:{left:!1,right:!1,bottom:!0,top:!0},listeners:{move(t){var n=t.target,o=0,r=0;n.style.width=t.rect.width+"px",n.style.height=t.rect.height+"px",Plotly.relayout(e,{height:t.rect.height}),o+=t.deltaRect.left,r+=t.deltaRect.top,n.style.webkitTransform=n.style.transform="translate("+o+"px,"+r+"px)"}}})}}]);
//# sourceMappingURL=bundle.js.map